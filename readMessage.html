<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin DashBoard</title>
    <link rel="stylesheet" href="ASSETS/CSS/style.css">
    <script>
        let logged = "";
        logged = window.localStorage.getItem("current_user");
        const theLoggedUser = JSON.parse(logged);
        if(logged === null || theLoggedUser.isAdmin === false){
            window.location.href="login.html";
        }
        let id = theLoggedUser._id;

    </script>
</head>
<body>
        <div class="inner_maind">
            <div class="left_inner_main_d">
                <div class="logo flex-center-center"><a href="index.html">My&nbsp;Brand&nbsp;Andre</a></div>
                <div class="side_nav_btn flex-center-center">
                    <ul>
                        <li><button type="button" onclick="window.location.href='adminDashboard.html'">Dashboard</button></li>
                        <li><button type="button" onclick="window.location.href='blogsCategory.html'">Blog&nbsp;Categories</button></li>

                        <li><button type="button" onclick="window.location.href='myBlogs.html'">My&nbsp;Blogs</button></li>
                        <li><button type="button" onclick="window.location.href='blogger.html'">Bloggers</button></li>
                        <li><button type="button" onclick="window.location.href='profile.html'">Profile</button></li>
                        <li><button type="button" class="logout_btn flex-center-center logoutDash"><img src="ASSETS/IMAGES/Shutdown_52px.png" alt="shutdown">Logout</button></li>
                    </ul>
                </div>
            </div>
            <div class="right_inner_main_d">
                <div class="dash_title flex-between-center">
                    <div class="logo flex-center-center" id="logd"><a href="index.html">My&nbsp;Brand&nbsp;Andre</a></div>

                    <div class="leftDash flex-between-center">
                        <span class="dashboardT">DASHBOARD</span>
                        <span class="dashboardUser">Admin</span>
                    </div>
                    <div class="rightDash flex-between-center">
                        <div class="user_logo flex-center-center">
                            <img src="ASSETS/IMAGES/Circled User Male_50px.png" alt="user"><span>Andre</span>
                        </div>
                        <button type="button" class="logoutDash">Logout</button>
                    </div>
                    <div class="dashMenu" id="menud" onclick="openMenu()"><img src="ASSETS/IMAGES/Menu_50px.png" alt="menuPic"></div>

                </div>
                <div class="innerDashboard_title">
                    <h3>Message</h3>
                </div>
                <div class="filter">
                   
                    <Button onclick="window.location.href='adminDashboard.html'">Back</Button>
                    
                </div>
                <div class="table_dash">
                    <h6>Contact Message</h6>
                    <table class="displayMsg_tbody">
                        
                    </table>
                </div>
               
            </div>
        </div>

        <!-- DASHBOARD MENU -->
        <div class="dashboard_modal hide">
            <div class="dashMenu_Close">
                <button type="button" class="close_dashMenu" onclick="closeMenu()"><img src="ASSETS/IMAGES/Multiply_52px.png" alt="close"></button>
            </div>
            <div class="side_nav_btn flex-center-center">
                <ul>
                    <li><button type="button" onclick="window.location.href='adminDashboard.html'">Dashboard</button></li>
                    <li><button type="button" onclick="window.location.href='blogsCategory.html'">Blog&nbsp;Categories</button></li>
                    <li><button type="button" onclick="window.location.href='myBlogs.html'">My&nbsp;Blogs</button></li>
                    <li><button type="button" onclick="window.location.href='blogger.html'">Bloggers</button></li>
                    <li><button type="button" onclick="window.location.href='profile.html'">Profile</button></li>
                    <li><button type="button" class="logout_btn flex-center-center logoutDash"><img src="ASSETS/IMAGES/Shutdown_52px.png" alt="shutdown">Logout</button></li>
                </ul>
            </div>
        </div>
        <script src="ASSETS/JS/blogger.js"></script>
        <script>
            // DASHBOARD MENU
                const readLocalStorageContact = () => {
                let getData = window.localStorage.getItem("contacts");
                let db = JSON.parse(getData);
                return db;
                };

                const updateLocalStorageContact = (data) => {
                let dataBaseText = JSON.stringify(data);
                window.localStorage.setItem("contacts", dataBaseText);
                };

                let msgId = window.sessionStorage.getItem("messageID");
                let idMsg = JSON.parse(msgId);
                console.log(idMsg);
                let messages = readLocalStorageContact();
                console.log(messages);
                if(messages !== null){
                   let currentMessage = messages.find(rec => rec.msgID === idMsg);
                   console.log(currentMessage);
                   currentMessage.readStatus = 1;
                   updateLocalStorageContact(messages);

                   document.querySelector(".displayMsg_tbody").innerHTML = `
                        <thead>
                            <tr>
                                <th>Sender:</th>
                                <th>${currentMessage.name}</th>
                            </tr>
                                <th>Email:</th>
                                <th>${currentMessage.email}</th>
                            </tr>    
                            <tr>
                                <th>Sent on:</th>
                                <th>${currentMessage.date}</th>
                            </tr>                                
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="4"><p>${currentMessage.msg}</p></td>
                            </tr>
                        </tbody>
                   `;

                }
                
                /** ========================================================
                 *                        LOGOUT
                 ========================================================== */
                 const logoutFunction = (e) => {
                e.preventDefault();
                window.localStorage.removeItem("loggedUser");
                window.location.href = "login.html";
                };

                if (document.querySelectorAll(".logoutDash")) {
                document.querySelectorAll(".logoutDash").forEach((btn) => {
                    btn.addEventListener("click", logoutFunction);
                });
                }

                

                             
                document.querySelector(".user_logo").innerHTML = `
                    <img src="${theLoggedUser.picture}" alt="user"><span>${theLoggedUser.FullName}</span>
                    `;

        </script>
</body>
</html>